## **장고 기초**
---
> **장고 개발 준비 과정 공부**
---
## **Django**
* **장고란?**
    * 장고는 웹 프로그램을 쉽고 빠르게 만들 수 있도록 도와주는 웹 프레임워크 임
        * **웹 프레임워크란**
            * 예를 들어 쿠키나 세션 처리, 로그인/로그아웃 처리, 권한처리, 데이터베이스 처리 등 웹 프로그램을 위해 만들어야 할 기능이 정말 많음
            * 웹 프레임워크를 사용하면 이런 기능들을 일일이 만들 필요가없음
            * 웹 프레임워크에는 그런 기능들이 이미 만들어져 있기 때문, 웹 프레임워크에 있는 기능을 익혀서 사용하기만 하면 됨
            * 웹 프레임워크는 웹 프로그램을 만들기 위한 스타터 키트라고 생각하자
* **얼마나 빨리 만들수 있을까**
    * 장고의 몇 가지 규칙만 익히면 누구나 빠르게 웹 프로그램을 만들 수 있음
    * 웹 브라우저에 'Hello World'를 출력하려면 장고가 요구하는 간단한 URL 규칙을 정의하고 다음과 같은 함수 하나만 작성하면 됨
    ```python
    def index(request):
    return HttpResponse("Hello World")
    ```
* **장고는 튼튼한 웹 프레임워크 임**
    * 개발자가 웹 프로그램을 만들 때 가장 어렵게 느끼는 기능 중 하나는 바로 보안 기능임
    * 보안 공격에 개발자 홀로 신속하게 대응하기는 어려움, 하지만 장고는 이런 보안 공격을 기본으로 아주 잘 막아줌
        * 예를 들어 SQL인젝션, XSS, CSrF, 클릭재킹 과 같은 보안 공격을 기본으로 막아줌, 이런 보안 공격에 대한 코드를 짤 필요가 없어짐
            * SQL 인젝션은 악의적인 SQL을 주입하여 공격하는 방법임
            * XSS는 자바스크립트를 삽입해 공격하는 방법임
            * CSRF는 위조된 요청을 보내는 공격 방법임
            * 클릭재킹은 사용자의 의도하지 않은 클릭을 유도하는 공격 방법임
* **장고에는 여러 기능이 준비되어 있음**
    * 장고는 2005년에 등장한 17년째 사용되고 있는 웹 프레임 워크로 그동안 무수히 많은 기능이 추가되고 다듬어짐
    * 단지 기능이 존재하기만 하는것이 아니라 잘 만들어져 있음
    * 우리가 필요로하는 웹 프로그램 개발을 위한 도구와 기능이 대부분 준비되어 있음
---
## **장고의 작동흐름**
* ![장고흐름](https://eunhyejung.github.io/assets/contents/django-content01.PNG)
* 웹 브라우저에서 어떤 이벤트가 발생한다고 하자
    * (여기서 이벤트는 특정 url을 클릭한다던지, 폼에 데이터를 입력해 보내는 등의 액션을 뜻함)
* 이벤트가 발생하면 장고 서버로 request(이벤트를 처리해달라)가 들어오게 됨
* 장고 서버로 들어온 이벤트에 대해 URL 디스패처가 URL을 분석해서, 적합한 VIEW로 이 요청을 보냄
* VIEW는 사용자 요청을 받아 데이터 베이스 어디에 접근해서 어떤 데이터를 가공할것인지 MODEL에게 알려줌
* MODEL은 DB와 커넥션을 해서 필요한 DB 연산을 처리함
* DB가 다시 모델로 결과값을 보내주면 모델이 이것을 뷰로 전달함
* VIEW는 우리에게 보내줄 데이터를 다시 TEMPLATE에게 전달해줌
* TEMPLATE는 .js나 .html과 같은 페이지를 만들어서 웹브라우저에게 넘겨줌
---
## **장고 기본 파일 구조**
![파일구조](https://eunhyejung.github.io/assets/contents/django-content02.PNG)
* 장고 프로젝트를 생성하게 되면 위 사진 처럼 다양한 파일들이 생성됨
* 주로 녹색 네모들이 우리가 실질적으로 다루는것들이라고 생각하면됨
* 미들웨어 라는것은 우리가 느낄수는 없지만 장고 뒤에서 다양한 처리를 도와줌
* WSGI는 웹서버와 장고를 적절하게 결합해주는 역할을 담당함
* urls.py파일은 정규표현식으로 구성되어 있음
* **Project와 App**
* 하나의 프로젝트가 하나의 웹사이트라고 생각하면 됨
* 프로젝트 안에는 다양한 기능들이 있고, 어떤 의미있는 기능들을 App으로 관리함
* 프로젝트 생성시 아래와 같은 파일구족 만들어짐
![파일구조1](https://eunhyejung.github.io/assets/contents/django-content03.PNG)
* ```setting.py```는 전체 프로젝트를 관리하느 설정파일임
* admin 파일은 관리자 권한을 가진 사용자가 볼 수 있는 페이지에 대한 내용을 다룸
* models.py는 DB와 관련된 다양한 역할을 수행함
* view는 db로 가져온 데이터를 적절히 가공하는 역할을 담당
* migrations는 db관련 폴더
* **Setting.py**
* Setting.py는 프로젝트 환경설정에 대한 내용을 담고있음
* DEBUG
디버그 설정 개발시에는 true값으로 지정해놓고 실제 서비스 배포시에는 false로 설정
* INSTALLED_APPS
    * pip로 설치한 앱 또는 본인이 만든 app추가
* MIDDLEWARE_CLASSES
    * request와 response 사이의 주요 기능 레이어
    (인증, 보안관련 내용을 다룸)
* TEMPLATES
    * 장고 템플릿 관련 설정, 실제 뷰(html)를 관리
* DATABASES
    * 데이터베이스 엔진의 연결 설정
* STATIC_URL
    * 정적파일의 URL(css, javascript, image 등)
* **Manage.py**
* 프로젝트 관리를 도와줌, 다른 설치작업없이 컴퓨터에서 웹서버 실행 가능
* 주요 명령어

    * ```startapp``` : 앱 생성
    * ```runserver``` : 서버 실행
    * ```createsuperuser``` : 관리자 생성
    * ```makemigrations app``` : app 모델의 변경사항 체크
    * ```migrate``` : 변경사항을 DB에 반영
    * ```shell``` : 쉘을 통해 데이터를 확인
    * ```collectstatic``` : static 파일을 한곳에 모음.

---
## **장고 개발환경 준비하기**
* **파이썬 가상 환경 알아보기**
    * 파이썬 가상 환경은 파이썬 프로젝트를 진행할 때 독립된 환경을 만들어 주는 도구 임
    * 파이썬 가상환경을 이용하면 하나의 PC에 서로 다른 버전의 파이썬과 라이브러리를 쉽게 설치해 사용할 수 있음
* **파이썬 가상환경 사용해 보기**
    * 파이썬 가상 환경을 만드는 명령어 : ```python -m venv 가상환경 이름```
    * 명령에서 ```python -m venv```는 파이썬 모듈 중 venv 라는 모듈을 사용한다는 의미임
    * 위 명령을 잘 실행하면 가상환경 이름에 해당하는 디렉토리가 경로 아래에 생성 됨 생성된 그 디렉토리를 가상 환경이라고 생각하면 됨
    * 가상 환경을 만들었다 해서 바로 가상 환경을 사용할 수는 없음, 가상 환경을 사용하려면 가상 환경에 진입해야 함
    * 가상 환경에 진입하려면 생성한 가상환경 이름의 디렉토리 안에 있는 ```Scripts``` 디렉터리의 ```activate```명령을 수행해야 함
    ```
    C:\> cd C:\경로...\가상환경 이름\Scripts
    C:\경로...\가상환경 이름\Scripts> activate
    (가상환경 이름) C:\경로...\가상환경 이름\Scripts>
    ```
    * ```activate``` 를 하였다면 C:/ 왼쪽에```(가상환경 이름)```라는 프롬프트를 확인할수 있음 현재 가상환경에 진입한 상태라는 의미
    * 진입한 가상 환경을 벗어나려면 ```deactivate```라는 명령을 실행하면 됨, 이 명령은 어느위치에서 실행해도 상관없음
* **장고 설치**
    * 가상환경이 이 진입되어있는지 확인 후 ```pip install django==(버전)```명령을 입력하면 됨
    * pip은 파이썬 라이브러리를 설치하고 관리해 주는 파이썬 도구임
    * - pip은 '핍'이라 읽음
    * 장고 설치시 마지막에 경고 문구가 보일수있음 pip가 최신 버전이 아니라는 내용의 경고문
    * 해결법은 python ```-m pip install --upgrade pip```명령을 입력하여 pip을 최신 버전으로 설치하면 됨
---
## **장고 프로젝트 생성하기**
* **장고 프로젝트**
    * 장고에는 프로젝트 라는 개념이 있음, 장고의 프로젝트는 하나의 웹 사이트 라고 생각하면 됨 즉, 장고 프로젝트를 생성하면 한 개의 웹 사이트를 생성하는 것과 같음
    * 프로젝트 안에는 여러 개의 앱이 존재함
    * 이 앱들이 모여 웹 사이트를 구성함 여기서 앱이란 관리자 앱, 인증 앱 등과 같이 장고가 기본으로 제공하는 앱과 개발자가 직접 만든 앱을 칭함
* **프로젝트 생성하기**
    * 장고 프로젝트는 여러 개가 될 수 있으므로 프로젝트를 모아 둘 프로젝트 루트 디렉터리 생성은 필수임
    * 루트 디렉토리를 생성하고 해당 디렉토리로 이동후 ```C:\경로...\가상환경 이름\Scripts\activate```를 통해 가상환경에 진입
    * projects 안에 프로젝트를 의미하는 디렉토리를 하나 만든후 ```cd``` 로 이동
    * 그 후 ```django-admin startproject config .```명령으로 장고 프로젝트를 생성
        * 이때 config 다음에 점 기호(```.```)가 있음을 주의해야함, 점 기호는 현재 디렉토리를 의미함
    * 위 명령의 의미는 현재 디렉토리인 mysite를 기준으로 프로젝트를 생성하겠다는 의미임
    * 프로젝트가 생성되면 프로젝트를 의미하는 디렉토리 밑에 장고가 필요로 하는 여러 디렉토리와 파일들이 생성됨
* **개발 서버 구동하고 웹 사이트에 접속해 보기**
    * 프로젝트를 생성 했으니 구동을 해보아야 함
    * ```python manage.py runserver``` 명령을 입력하고
    ```
    Starting development server at http://127.0.0.1:8000/
    Quit the server with CONTROL-C.
    ```
    * 위 내용은 장고 서버가 ```http://127.0.0.1:8000/```로 시작되었다는 것과 서버를 중지하기 위해서는 ```CONTROL-C```를 입력하라는 것임
    * 이렇게 개발을 위해 실행되는 장고 서버는 로컬호스트(localhost)로 실행되기 때문에 로컬 서버라고 부름
    * 웹 브라우저의 주소창에```http://127.0.0.1:8000/```를 입력하면 아래 사진 같은 화면이 보임
    ![장고 화면](https://wikidocs.net/images/page/72377/O_1-04_1.png)
    * ```http://127.0.0.1:8000/``` 대신 ```http://localhost:8000/``` 라고 입력해도 동일한 결과를 볼 수 있음
        * 127.0.0.1 과 localhost는 모두 나의 PC를 가리키는 아이피 주소이기 때문임
* **가상환경에 간단히 진입하는법**
    * 가상 환경에 진입하려면 매번 명령 프롬프트를 실행하고 디렉토리로 이동후 명령을 수행해야함
    * 이런 일련의 과정을 한 번에 수행할 수 있는 배치 프로그램을 만들어 귀찮음을 덜을수 있음
    * (구글링으로 찾자 여기서 설명하기에는 너무 복잡함)
---
## **장고 개발환경**
* **인터프리터**
    * 장고 프로젝트를 불러온 후 가장 먼저 해야 할 일은 장고 프로젝트가 바라봐야 할 파이썬 인터프리터 위치를 설정하는 것
* 간단한 환경 설정으로 ```setting.py```에 가보면 ```LANGUAGE_CODE```와 ```TIME_ZONE```이 있음 한국어와 한국 시간을 원한다면 두개를 ```LANGUAGE_CODE = 'ko-kr'```와 ```TIME_ZONE = 'Asia/Seoul'```로 바꾸어 주면 됨